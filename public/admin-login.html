<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>관리자 로그인</title>
    <link rel="stylesheet" href="admin.css" />
  </head>

  <body class="admin-login">
    <div class="login-box">
      <h2>관리자 로그인</h2>

      <form id="loginForm" class="login-form">
        <div class="form-group">
          <label for="username">아이디</label>
          <input type="text" id="username" />
        </div>
        <div class="form-group">
          <label for="password">비밀번호</label>
          <input type="password" id="password" />
        </div>

        <button id="loginBtn" type="button">로그인</button>

        <p id="errorMsg" style="color: red; text-align: center; margin-top: 10px"></p>
      </form>
    </div>

    <script>
      // [추가] 페이지 로드 시 URL 파라미터를 확인하는 리스너
      document.addEventListener('DOMContentLoaded', () => {
        const errorMsgEl = document.getElementById('errorMsg');
        const params = new URLSearchParams(window.location.search);

        if (params.get('error') === 'unauthorized') {
          errorMsgEl.textContent = '관리자 권한이 없습니다. 먼저 로그인하세요.';
          // URL에서 에러 쿼리 파라미터를 깔끔하게 제거 (선택 사항)
          window.history.replaceState({}, document.title, '/admin-login');
        }
      });

      // [기존] 로그인 버튼 클릭 이벤트
      document.getElementById('loginBtn').addEventListener('click', async () => {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorMsgEl = document.getElementById('errorMsg');

        // [추가] 로그인 시도 시 기존 에러 메시지 삭제
        errorMsgEl.textContent = '';

        try {
          const response = await fetch('/api/admin/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
          });

          if (response.ok) {
            window.location.href = '/admin'; // 로그인 성공 시 관리자 페이지로
          } else {
            const data = await response.json();
            errorMsgEl.textContent = data.error || '로그인 실패';
          }
        } catch (error) {
          errorMsgEl.textContent = '서버 통신 오류';
        }
      });

      // [기존] 엔터 키로 로그인
      document.getElementById('password').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('loginBtn').click();
        }
      });
      document.getElementById('username').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('loginBtn').click();
        }
      });
    </script>
  </body>
</html>
